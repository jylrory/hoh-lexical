import{j as e,t as O,r as l,l as k,u as P,b as I,c as j,v as $,w as R,m as B,K as F,p as x,x as K,o as Y,q as G,D as U,s as z,S as W,L as q,A as H,y as J,R as Q,z as V,F as X,$ as Z,T as ee,G as te,B as ne}from"./main-W2OY7dnc.js";function se({children:n,label:c,className:s,...f}){return e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("label",{style:{marginTop:"-1em"},className:"Input__label",children:c}),e.jsx("select",{...f,className:s||"select",children:n})]})}const L=new Set;function ae(n){if(!L.has(n))throw new Promise(c=>{const s=new Image;s.src=n,s.onload=()=>{L.add(n),c(null)}})}function le({altText:n,className:c,imageRef:s,src:f,width:u,height:m,position:d}){return ae(f),e.jsx("img",{className:c||void 0,src:f,alt:n,ref:s,"data-position":d,style:{display:"block",height:m,width:u},draggable:"false"})}function oe({activeEditor:n,nodeKey:c,onClose:s}){const u=n.getEditorState().read(()=>Z(c)),[m,d]=l.useState(u.getAltText()),[N,_]=l.useState(u.getShowCaption()),[S,C]=l.useState(u.getPosition()),E=g=>{_(g.target.checked)},o=g=>{C(g.target.value)},p=()=>{const g={altText:m,position:S,showCaption:N};u&&n.update(()=>{u.update(g)}),s()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(ee,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:d,value:m,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(se,{style:{marginBottom:"1em",width:"208px"},value:S,label:"Position",name:"position",id:"position-select",onChange:o,children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:N,onChange:E}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(te,{children:e.jsx(ne,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>p(),children:"Confirm"})})]})}function re({src:n,altText:c,nodeKey:s,width:f,height:u,showCaption:m,caption:d,position:N}){const[_,S]=O(),C=l.useRef(null),E=l.useRef(null),[o,p,g]=k(s),[t]=P(),[v,T]=l.useState(null),A=l.useRef(null),b=l.useCallback(i=>{const r=I();return o&&j(r)&&(i.preventDefault(),o&&j(r)&&t.update(()=>{r.getNodes().forEach(h=>{$(h)&&h.remove()})})),!1},[t,o]),D=l.useCallback(i=>{const r=I(),a=E.current;if(o&&j(r)&&r.getNodes().length===1){if(m)return R(null),i.preventDefault(),d.focus(),!0;if(a!==null&&a!==document.activeElement)return i.preventDefault(),a.focus(),!0}return!1},[d,o,m]),M=l.useCallback(i=>A.current===d||E.current===i.target?(R(null),t.update(()=>{p(!0);const r=t.getRootElement();r!==null&&r.focus()}),!0):!1,[d,t,p]);l.useEffect(()=>{let i=!0;const r=B(t.registerUpdateListener(({editorState:a})=>{i&&T(a.read(()=>I()))}),t.registerCommand(W,(a,h)=>(A.current=h,!1),x),t.registerCommand(z,a=>{const h=a;return h.target===C.current?(h.shiftKey?p(!o):(g(),p(!0)),!0):!1},x),t.registerCommand(U,a=>a.target===C.current?(a.preventDefault(),!0):!1,x),t.registerCommand(G,b,x),t.registerCommand(Y,b,x),t.registerCommand(K,D,x),t.registerCommand(F,M,x));return()=>{i=!1,r()}},[g,t,o,s,b,D,M,p]);const w=o&&j(v),y=o;return e.jsxs(l.Suspense,{fallback:null,children:[e.jsxs(e.Fragment,{children:[e.jsxs("span",{draggable:w,children:[e.jsx("button",{className:"image-edit-button",ref:E,onClick:()=>{S("Update Inline Image",i=>e.jsx(oe,{activeEditor:t,nodeKey:s,onClose:i}))},children:"Edit"}),e.jsx(le,{className:y?`focused ${j(v)?"draggable":""}`:null,src:n,altText:c,imageRef:C,width:f,height:u,position:N})]}),m&&e.jsx("span",{className:"image-caption-container",children:e.jsxs(q,{initialEditor:d,children:[e.jsx(H,{}),e.jsx(J,{}),e.jsx(Q,{contentEditable:e.jsx(V,{placeholder:"Enter a caption...",placeholderClassName:"InlineImageNode__placeholder",className:"InlineImageNode__contentEditable"}),ErrorBoundary:X})]})})]}),_]})}export{oe as UpdateInlineImageDialog,re as default};
