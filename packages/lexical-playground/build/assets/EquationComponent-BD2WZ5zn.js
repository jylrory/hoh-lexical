import{r,j as e,u as x,$ as g,a as N,m as q,K as C,C as p,S as _,b as j,c as S,E as h,d as $}from"./main-DamQUiVq.js";function v({equation:a,setEquation:c,inline:i},t){const n=E=>{c(E.target.value)};return i&&t instanceof HTMLInputElement?e.jsxs("span",{className:"EquationEditor_inputBackground",children:[e.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),e.jsx("input",{className:"EquationEditor_inlineEditor",value:a,onChange:n,autoFocus:!0,ref:t}),e.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):e.jsxs("div",{className:"EquationEditor_inputBackground",children:[e.jsx("span",{className:"EquationEditor_dollarSign",children:`$$
`}),e.jsx("textarea",{className:"EquationEditor_blockEditor",value:a,onChange:n,ref:t}),e.jsx("span",{className:"EquationEditor_dollarSign",children:`
$$`})]})}const M=r.forwardRef(v);function R({equation:a,inline:c,nodeKey:i}){const[t]=x(),[n,E]=r.useState(a),[u,d]=r.useState(!1),m=r.useRef(null),f=r.useCallback(o=>{d(!1),t.update(()=>{const s=g(i);N(s)&&(s.setEquation(n),o&&s.selectNext(0,0))})},[t,n,i]);return r.useEffect(()=>{!u&&n!==a&&E(a)},[u,a,n]),r.useEffect(()=>u?q(t.registerCommand(_,o=>{const s=document.activeElement;return m.current!==s&&f(),!1},p),t.registerCommand(C,o=>{const s=document.activeElement;return m.current===s?(f(!0),!0):!1},p)):t.registerUpdateListener(({editorState:o})=>{o.read(()=>{const l=j();return S(l)&&l.has(i)&&l.getNodes().length===1})&&d(!0)}),[t,i,f,u]),e.jsx(e.Fragment,{children:u?e.jsx(M,{equation:n,setEquation:E,inline:c,ref:m}):e.jsx(h,{onError:o=>t._onError(o),fallback:null,children:e.jsx($,{equation:n,inline:c,onDoubleClick:()=>d(!0)})})})}export{R as default};
