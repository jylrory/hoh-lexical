import{u as E,r as p,l as S,b as P,c as j,H as O,m as b,o as D,p as f,q as I,s as $,j as t,B as M,J as A,N as k,$ as R,O as y}from"./main-D6RrrMLT.js";function L(n){return n.reduce((c,a)=>c+a.votes.length,0)}function V({option:n,index:c,options:a,totalVotes:s,withPollNode:N}){const{clientID:r}=A(),m=p.useRef(null),_=n.votes,h=_.indexOf(r)!==-1,i=_.length,x=n.text;return t.jsxs("div",{className:"PollNode__optionContainer",children:[t.jsx("div",{className:k("PollNode__optionCheckboxWrapper",h&&"PollNode__optionCheckboxChecked"),children:t.jsx("input",{ref:m,className:"PollNode__optionCheckbox",type:"checkbox",onChange:d=>{N(l=>{l.toggleVote(n,r)})},checked:h})}),t.jsxs("div",{className:"PollNode__optionInputWrapper",children:[t.jsx("div",{className:"PollNode__optionInputVotes",style:{width:`${i===0?0:i/s*100}%`}}),t.jsx("span",{className:"PollNode__optionInputVotesCount",children:i>0&&(i===1?"1 vote":`${i} votes`)}),t.jsx("input",{className:"PollNode__optionInput",type:"text",value:x,onChange:d=>{const l=d.target,C=l.value,e=l.selectionStart,o=l.selectionEnd;N(u=>{u.setOptionText(n,C)},()=>{l.selectionStart=e,l.selectionEnd=o})},placeholder:`Option ${c+1}`})]}),t.jsx("button",{disabled:a.length<3,className:k("PollNode__optionDelete",a.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{N(d=>{d.deleteOption(n)})}})]})}function K({question:n,options:c,nodeKey:a}){const[s]=E(),N=p.useMemo(()=>L(c),[c]),[r,m,_]=S(a),[g,h]=p.useState(null),i=p.useRef(null),x=p.useCallback(e=>{const o=P();return r&&j(o)&&(e.preventDefault(),s.update(()=>{o.getNodes().forEach(v=>{O(v)&&v.remove()})})),!1},[s,r]);p.useEffect(()=>b(s.registerUpdateListener(({editorState:e})=>{h(e.read(()=>P()))}),s.registerCommand($,e=>{const o=e;return o.target===i.current?(o.shiftKey||_(),m(!r),!0):!1},f),s.registerCommand(I,x,f),s.registerCommand(D,x,f)),[_,s,r,a,x,m]);const d=(e,o)=>{s.update(()=>{const u=R(a);O(u)&&e(u)},{onUpdate:o})},l=()=>{d(e=>{e.addOption(y())})},C=j(g)&&r;return t.jsx("div",{className:`PollNode__container ${C?"focused":""}`,ref:i,children:t.jsxs("div",{className:"PollNode__inner",children:[t.jsx("h2",{className:"PollNode__heading",children:n}),c.map((e,o)=>{const u=e.uid;return t.jsx(V,{withPollNode:d,option:e,index:o,options:c,totalVotes:N},u)}),t.jsx("div",{className:"PollNode__footer",children:t.jsx(M,{onClick:l,small:!0,children:"Add Option"})})]})})}export{K as default};
